import { createRouteHandlerClient } from "@supabase/auth-helpers-nextjs"; import { cookies } from "next/headers"; import { NextResponse } from "next/server"; export async function POST(request: Request) { try { const { tallerId, userId } = await request.json(); if (!tallerId || !userId) { return NextResponse.json({ error: "Se requiere tallerId y userId" }, { status: 400 }); } const supabase = createRouteHandlerClient({ cookies }); const { data: taller, error: tallerError } = await supabase.from("talleres").select("id").eq("id", tallerId).single(); if (tallerError || !taller) { return NextResponse.json({ error: "Taller no encontrado" }, { status: 404 }); } const { data: usuario, error: usuarioError } = await supabase.from("usuarios").select("id").eq("id", userId).single(); if (usuarioError || !usuario) { return NextResponse.json({ error: "Usuario no encontrado" }, { status: 404 }); } const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || "http://localhost:3000"; const urlReferido = `${baseUrl}/talleres/${tallerId}/${userId}`; return NextResponse.json({ url: urlReferido }); } catch (error) { console.error("Error al generar URL de referido:", error); return NextResponse.json({ error: "Error al generar URL de referido" }, { status: 500 }); } }
